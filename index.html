<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Procster: Procster - List OS Processes over the Web</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Procster
   &#160;<span id="projectnumber">0.1</span>
   </div>
   <div id="projectbrief">Procster-ViewProcessesovertheweb</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('index.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">Procster - List OS Processes over the Web </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>Procster is a simple microhttpd based HTTP service that lists processes via a REST/JSON Web API.</p>
<p>Procster is meant to serve you in a toolkit / API manner, so that you merely tap on to it with your favorite HTTP client and decide what you do with data.</p>
<h2>Procster Design Rationale</h2>
<p>Procster is written on top of 4 main, reusable footings:</p><ul>
<li>procps - Linux process lister API, also used by "ps" and "top" utilities</li>
<li>microhttpd - Lightweight, standalone HTTP server</li>
<li>glib - For helper data structures</li>
<li>libjansson - JSON library to parse and serialize JSON</li>
</ul>
<p>Choosing a very slim "embedded" web server (Instead of general purpose web server like Apache or NginX) and efficient libraries for other tasks keeps the memory footprint on the system "unnoticable". As such Procster should be easily runnable on SBC systems like RaspberryPi, Beaglebone, Odroid, etc.</p>
<h2>Procster and security</h2>
<p>Typically listing OS processes is not someting you want to do in the world of hacks and cracks and security breaches. This makes Procster mainly an intranet, home or closed network tool. See additional config possibilities of using HTTPS, authenication (HTTP Basic Auth or API Key).</p>
<h2>Compiling, Running and Testing</h2>
<p>Clone source from Github: </p><div class="fragment"><div class="line">git clone https://github.com/ohollmen/procster.git</div><div class="line">cd procster</div></div><!-- fragment --><p> Install dependencies (e.g) on Ubuntu 18.04: </p><div class="fragment"><div class="line"># For Processlister ... (procps 3.3.12, jansson 2.11)</div><div class="line">sudo apt-get install -y libprocps6 libprocps-dev libjansson4 libjansson-dev</div><div class="line">sudo apt-get install -y libglib2.0-dev</div><div class="line"># For Microhttpd</div><div class="line">sudo apt-get install -y libmicrohttpd12 libmicrohttpd-dev</div></div><!-- fragment --><p> For static linking you may additionally need: </p><div class="fragment"><div class="line">sudo apt-get install -y libc6-dev libgnutls28-dev libpcre3-dev zlib1g-dev libsystemd-dev libp11-dev libidn2-dev libunistring-dev</div><div class="line">libtasn1-6-dev nettle-dev libgmp-dev liblzma-dev liblz4-dev libgcrypt20-dev</div><div class="line">libffi-dev libgpg-error-dev</div></div><!-- fragment --><p>... or Centos/RH (7.6): </p><div class="fragment"><div class="line"># procps 3.3, jansson 2.10</div><div class="line">sudo yum install -y procps-ng procps-ng-devel jansson jansson-devel</div><div class="line"># TODO: glib2-static</div><div class="line">sudo yum install -y glib2 glib2-devel</div><div class="line">sudo yum install -y libmicrohttpd libmicrohttpd-devel</div></div><!-- fragment --><p> On any of the older distros and Linux versions with older procps (e.g. Ubuntu 14.04 has libprocps3 - 3.3.9), compile libprops out of source code (see separate section for short instructions on this).</p>
<p>Compile libraries and process server:</p>
<div class="fragment"><div class="line">make</div></div><!-- fragment --><p> Test CLI Utility output (No HTTP involved): </p><div class="fragment"><div class="line"># Compact JSON</div><div class="line">./proctest</div><div class="line"># Prettified JSON</div><div class="line">./proctest | python -m json.tool | less</div></div><!-- fragment --><p> Run HTTP/REST/JSON Process server (pass port as arg): </p><div class="fragment"><div class="line"># On terminal/console (blocking)</div><div class="line">procserver 8181</div><div class="line"># Via systemd (See Makefile for instructions to generate unit file)</div><div class="line"># See unit file for hints and instructions</div><div class="line"># Once only:</div><div class="line">sudo systemctl enable --now `pwd`/procster.service</div><div class="line"># Later use normal systemd commands (leave out .service)</div><div class="line">sudo systemctl restart procster</div></div><!-- fragment --><p> Test HTTP Output: </p><div class="fragment"><div class="line"># As-is compact JSON</div><div class="line">curl http://localhost:8181/proclist</div><div class="line"># Prettified JSON, Inspect with pager</div><div class="line">curl http://localhost:8181/proclist | python -m json.tool | less</div></div><!-- fragment --> <h2>Installing on large number of machines</h2>
<p>Initial install: </p><div class="fragment"><div class="line"># Run copying of config JSON as template</div><div class="line">make unit</div><div class="line"># Edit ~/.procster/procster.conf.json for your env.</div><div class="line"># keep &quot;docroot&quot; (document root) to absolute path (for e.g. systemd reasons)</div><div class="line">cat ~/.procster/procster.conf.json | ./node_modules/mustache/bin/mustache -  conf/procster.service.mustache &gt; ./procster.service</div><div class="line"># Install (Example)</div><div class="line"># Inventory in ~/.procster</div><div class="line">ansible-playbook -i ~/.procster/hosts conf/procster_install.yaml -b --extra-vars &quot;ansible_user=mrsmith ansible_sudo_pass=s3Cr3t hosts=myhost&quot;</div><div class="line"># Restart</div><div class="line">ansible-playbook -i ~/.procster/hosts conf/procster_restart.yaml -b --extra-vars &quot;ansible_user=mrsmith ansible_sudo_pass=s3Cr3t hosts=myhost&quot;</div></div><!-- fragment --> <h2>Compiling procps-ng afresh for Centos</h2>
<div class="fragment"><div class="line"># gettext gettext-libs gettext-devel gettext-common-devel</div><div class="line">yum -y install gettext gettext-libs gettext-devel</div><div class="line">cd /tmp</div><div class="line">git clone https://gitlab.com/procps-ng/procps</div><div class="line">cd procps</div><div class="line"># Need GNU gettext/autopoint, libtool-2, libtoolize</div><div class="line">./autogen.sh</div><div class="line">./configure --without-ncurses</div><div class="line">make</div><div class="line">sudo make install</div></div><!-- fragment --><p> This places include files and libraries under /usr/local/include/proc/ and /usr/local/lib respectively. Because of the way includes are referred (from <code>/proc</code>) subdir, the respective -I and -L options would be -I/usr/local/include/ -L/usr/local/lib (To testrun on Centos, you may need to add export LD_LIBRARY_PATH=/usr/local/lib or preferably add /usr/local/lib to /etc/ld.so.conf and run ldconfig). You should also uninstall procps-ng-devel from causing ambiguity with newly installed headers from (gitlab) source package (causing wrong structure offsets, wrong function signatures, etc.).</p>
<h2>Debugging The Procster</h2>
<p>Compile (proclist CLI utility) with debug info (-g / -ggdb). Add this option into the Makfile line "CC=gcc ...". Start debug by launching: </p><div class="fragment"><div class="line">gdb ./proclist</div><div class="line">GNU gdb (Ubuntu 8.1-0ubuntu3.2) 8.1.0.20180409-git</div><div class="line">...</div><div class="line">Reading symbols from ./proclist...done.</div><div class="line">(gdb) b 176</div><div class="line">Breakpoint 1 at 0x555555555343: file proclist.c, line 176.</div><div class="line">(gdb) run tree</div><div class="line">Starting program: /home/mrsmith/projects/procster/proclist</div></div><!-- fragment --><p> Example: Check what all members (and member values) the proc_t has in it for particular procps(-ng) OS distro version: (line number examplary/approximate, try to hit the beginning of <a class="el" href="proclist_8c.html" title="Initial prototyping functions to create JSON process listings. ">proclist.c</a>:proc_list_json2 for loop): </p><div class="fragment"><div class="line">...</div><div class="line">(gdb) b proclist.c:152</div><div class="line">(gdb) run</div></div><!-- fragment --><p> Example of hitting error: </p><div class="fragment"><div class="line">...</div><div class="line">139     int ok = list2str(proc-&gt;cmdline, cmdline);</div><div class="line">(gdb) n</div><div class="line"></div><div class="line">Program received signal SIGSEGV, Segmentation fault.</div><div class="line">0x00007ffff7408d0b in __memcpy_ssse3_back () from /lib64/libc.so.6</div></div><!-- fragment --><p> Or the "lazy way" (run from very top level, ask a backtrace after crash): </p><div class="fragment"><div class="line">(gdb) run list</div><div class="line">The program being debugged has been started already.</div><div class="line">Start it from the beginning? (y or n) y</div><div class="line">Starting program: /projects/ccxsw/home/ccxswbuild/procster/./procs list</div><div class="line">[Thread debugging using libthread_db enabled]</div><div class="line">Using host libthread_db library &quot;/lib64/libthread_db.so.1&quot;.</div><div class="line"></div><div class="line">Program received signal SIGSEGV, Segmentation fault.</div><div class="line">0x00007ffff7408d0b in __memcpy_ssse3_back () from /lib64/libc.so.6</div><div class="line">(gdb) backtrace</div><div class="line">#0  0x00007ffff7408d0b in __memcpy_ssse3_back () from /lib64/libc.so.6</div><div class="line">#1  0x0000000000401b93 in list2str (list=0x6142d8, </div><div class="line">    buf=buf@entry=0x7fffffffe090 &quot;/export/electriccloud/electriccommander/jre/bin/java -server -XX:+UseG1GC -XX:+HeapDumpOnOutOfMemoryError -XX:+AggressiveOpts -XX:+UseFastAccessorMethods -Dec.logRoot=\&quot;logs/agent/jagent.log\&quot; -Dcommand&quot;...)</div><div class="line">    at procutil.c:114</div><div class="line">#2  0x0000000000401c49 in proc_to_json (proc=proc@entry=0x7fffffffdc80, </div><div class="line">    cmdline=cmdline@entry=0x7fffffffe090 &quot;/export/electriccloud/electriccommander/jre/bin/java -server -XX:+UseG1GC -XX:+HeapDumpOnOutOfMemoryError -XX:+AggressiveOpts -XX:+UseFastAccessorMethods -Dec.logRoot=\&quot;logs/agent/jagent.log\&quot; -Dcommand&quot;...)</div><div class="line">    at procutil.c:139</div><div class="line">#3  0x00000000004017ee in proc_list_json2 (flags=107, flags@entry=0) at proclist.c:153</div><div class="line">#4  0x0000000000401326 in main (argc=&lt;optimized out&gt;, argv=&lt;optimized out&gt;) at proclist.c:182</div></div><!-- fragment --> </div></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.13 </li>
  </ul>
</div>
</body>
</html>
